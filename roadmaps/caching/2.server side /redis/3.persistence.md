Baik, Bos! Sekarang kita masuk ke topik penting dalam Redis:

## ğŸŸ£ **4. Persistence (Penyimpanan ke Disk)**

Walau Redis dikenal sebagai **in-memory database**, Redis juga bisa **simpan data ke disk** supaya data tidak hilang saat Redis restart/crash.

---

## ğŸ” Tujuan Persistence:

* Redis **bisa recovery saat restart**
* Cocok untuk aplikasi yang **butuh durability** (bukan sekadar cache)
* Redis bisa jadi **primary database ringan**

---

## ğŸ” Jenis Persistence di Redis

### âœ… 1. **RDB (Redis Database File) â€“ Snapshot**

* Redis akan **ambil snapshot** semua data pada waktu tertentu dan simpan ke file `.rdb`
* Filenya: `dump.rdb`

### ğŸ”§ Cara Kerja:

* Redis menyimpan semua data dalam interval tertentu (misalnya setiap 5 menit).
* Sangat cepat **untuk backup dan restore**.

### ğŸ“˜ Konfigurasi di `redis.conf`:

```bash
save 900 1     # Setiap 900 detik (15 menit) jika ada â‰¥1 perubahan
save 300 10    # Setiap 5 menit jika â‰¥10 perubahan
```

### ğŸ”¨ Perintah Manual:

```bash
SAVE      # Blocking save (jarang digunakan)
BGSAVE    # Background save (disarankan)
```

### ğŸ“¦ Kelebihan:

* Ringan dan cepat
* File `.rdb` bisa dibackup ke tempat lain

### âš ï¸ Kekurangan:

* **Kalau Redis crash, bisa kehilangan data terakhir**
* Tidak cocok jika ingin data selalu 100% persisten

---

### âœ… 2. **AOF (Append-Only File)**

* Redis akan menyimpan **semua perintah write** (SET, DEL, LPUSH, dll) ke file `appendonly.aof`

### ğŸ”§ Cara Aktifkan AOF:

Di `redis.conf`:

```bash
appendonly yes
appendfsync everysec    # flush AOF setiap detik (trade-off antara durability dan performance)
```

### ğŸ“˜ Mekanisme:

* Saat Redis restart, dia akan **replay** semua command dari AOF untuk mengembalikan data.

### ğŸ“¦ Kelebihan:

* **Lebih aman daripada RDB**, karena data terakhir bisa disimpan hampir real-time
* Bisa **recover full state**

### âš ï¸ Kekurangan:

* File AOF bisa menjadi **besar**
* Replay saat startup bisa lebih **lambat** daripada RDB

---

### âœ… 3. **Kombinasi RDB + AOF (Disarankan untuk production)**

Bisa aktifkan keduanya:

* AOF untuk **durability real-time**
* RDB untuk **backup jangka panjang**

Saat Redis restart:

* Redis akan lebih **mengutamakan AOF**
* Jika AOF corrupt, Redis bisa fallback ke RDB

---

## ğŸ”„ Perbandingan RDB vs AOF

| Fitur          | RDB (Snapshot)                 | AOF (Append Only File)            |
| -------------- | ------------------------------ | --------------------------------- |
| Format File    | `dump.rdb`                     | `appendonly.aof`                  |
| Performance    | Lebih cepat                    | Lebih lambat (lebih sering tulis) |
| Recovery Speed | Cepat                          | Bisa lebih lama (banyak perintah) |
| Data Loss Risk | Bisa kehilangan menit terakhir | Hampir tidak ada (tiap detik)     |
| Ukuran File    | Lebih kecil                    | Lebih besar                       |

---

## ğŸ› ï¸ Tips Produksi:

* Aktifkan AOF (`appendonly yes`)
* Kombinasikan dengan RDB untuk backup
* Gunakan `appendfsync everysec` (default), cukup aman & cepat
* Lakukan `AOF rewrite` secara berkala untuk mengecilkan file:

```bash
BGREWRITEAOF
```

---

Kalau Bos siap, kita bisa lanjut ke:
â˜‘ï¸ **Pub/Sub system Redis**
â˜‘ï¸ **Queueing (misalnya pakai List atau Stream)**
â˜‘ï¸ **Session Store / JWT / Login cache**
â˜‘ï¸ atau **Atomic Transaction dengan MULTI/EXEC**

Bos mau yang mana?
